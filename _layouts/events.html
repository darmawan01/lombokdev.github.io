---
layout: default
---

<!-- _layouts/event.html -->
<article class="pt-24 pb-16 px-6 max-w-4xl mx-auto">
  {% if page.banner %}
    <img src="{{ page.banner }}" alt="{{ page.title }}" class="w-full rounded-xl mb-6">
  {% endif %}

  <h1 class="text-4xl font-bold mb-2">{{ page.title }}</h1>
  <p class="text-gray-500 mb-6">ğŸ“… {{ page.date | date: '%A, %B %d, %Y' }} â€¢ ğŸ“ {{ page.location }} â€¢ ğŸ•’ {{ page.duration }}</p>

  {% if page.description %}
    <p class="text-lg text-gray-700 mb-8">{{ page.description }}</p>
  {% endif %}

  {% if page.agenda %}
    <h2 class="text-2xl font-semibold mb-3">Agenda</h2>
    <ul class="space-y-2 mb-6">
      {% for item in page.agenda %}
        <li>â° {{ item.time }} â€” <strong>{{ item.topic }}</strong>{% if item.speaker %} ({{ item.speaker }}){% endif %}</li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if page.speakers %}
    <h2 class="text-2xl font-semibold mb-3">Speakers</h2>
    <ul class="space-y-2 mb-6">
      {% for sp in page.speakers %}
        <li><strong>{{ sp.name }}</strong>{% if sp.topic %} â€” {{ sp.topic }}{% endif %}</li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if page.registration_url %}
    <a href="{{ page.registration_url }}" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Register</a>
  {% endif %}

  {% if page.gallery_url %}
    <a href="{{ page.gallery_url }}" class="mt-3 inline-block bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
      View Gallery
    </a>
  {% endif %}

  <!-- Registration List -->
  <section id="registration-list" class="mt-10">
    <h2 class="text-2xl font-semibold mb-3">Registered Participants</h2>
    <p id="reg-loading" class="text-gray-500">Loading...</p>
    <table id="reg-table" class="hidden w-full border border-gray-300 rounded-lg overflow-hidden">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Full Name</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Email</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Registered At</th>
        </tr>
      </thead>
      <tbody id="reg-body" class="divide-y divide-gray-200"></tbody>
    </table>
  </section>
</article>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const eventId = "{{ page.event_id }}"; // should be defined in front matter
    const apiUrl = "https://xrxfvavgbcphhywznrfq.supabase.co/functions/v1/get-attendance"; 

    try {
      const res = await fetch(`${apiUrl}?event-id=${eventId}`);
      const data = await res.json();

      const loading = document.getElementById("reg-loading");
      const table = document.getElementById("reg-table");
      const body = document.getElementById("reg-body");

      if (!res.ok) {
        loading.textContent = "âš ï¸ Failed to load registrations.";
        return;
      }

      if (data.length === 0) {
        loading.textContent = "No participants registered yet.";
        return;
      }

      loading.classList.add("hidden");
      table.classList.remove("hidden");

      data.forEach((item) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="px-4 py-2 text-sm text-gray-800">${item.fullname || "-"}</td>
          <td class="px-4 py-2 text-sm text-gray-600">${item.email}</td>
          <td class="px-4 py-2 text-sm text-gray-600">${new Date(item.registered_at).toLocaleString()}</td>
        `;
        body.appendChild(tr);
      });
    } catch (err) {
      console.error("Fetch failed", err);
      document.getElementById("reg-loading").textContent = "âš ï¸ Unable to load participants.";
    }
  });
</script>
